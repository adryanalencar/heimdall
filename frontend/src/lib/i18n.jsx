import React, { createContext, useContext, useMemo, useState } from 'react';

const translations = {
  en: {
    nav: {
      appName: 'WhatsApp Campaign Manager',
      dashboard: 'Dashboard',
      connections: 'Connections',
      tags: 'Tags',
      contacts: 'Contacts',
      lists: 'Contact Lists',
      contactsImport: 'Import Contacts',
      campaigns: 'Campaigns',
    },
    common: {
      refresh: 'Refresh',
      loading: 'Loading...',
      success: 'Success',
      error: 'Error',
      required: '(required)',
      optional: '(optional)',
      connected: 'Connected',
      disconnected: 'Disconnected',
    },
    auth: {
      loginTitle: 'Sign in',
      loginSubtitle: 'Access your workspace',
      registerTitle: 'Create account',
      registerSubtitle: 'Set up your tenant workspace',
      firstName: 'First name',
      lastName: 'Last name',
      phone: 'Phone',
      email: 'Email',
      password: 'Password',
      loginButton: 'Sign in',
      registerButton: 'Create account',
      loginError: 'Unable to sign in. Check your credentials.',
      registerError: 'Unable to create account. Try again.',
      loading: 'Processing...',
      noAccount: "Don't have an account?",
      createAccount: 'Create one now',
      hasAccount: 'Already have an account?',
      signIn: 'Sign in',
      logout: 'Sign out',
    },
    dashboard: {
      title: 'Dashboard',
      subtitle: 'Overview of your messaging operations',
      quickActions: 'Quick actions',
      manageConnections: 'Manage connections',
      createTags: 'Create tags',
      addContacts: 'Add contacts',
      startCampaign: 'Start a campaign',
    },
    connections: {
      title: 'Connections',
      subtitle: 'Manage your messaging connections',
      createNew: 'Create new connection',
      name: 'Name',
      instanceName: 'Instance name',
      apiUrl: 'API URL',
      apiKey: 'API key',
      createBtn: 'Create connection',
      activeTitle: 'Active connections',
      noConnections: 'No connections found',
      successCreate: 'Connection created successfully.',
      errorCreate: 'Failed to create connection.',
      successDelete: 'Connection removed successfully.',
      errorDelete: 'Failed to remove connection.',
      errorFetch: 'Failed to load connections.',
    },
    tags: {
      title: 'Tags',
      subtitle: 'Organize contacts with tags',
      createNew: 'Create new tag',
      name: 'Tag name',
      createBtn: 'Create tag',
      allTags: 'All tags',
      noTags: 'No tags found',
      successCreate: 'Tag created successfully.',
      errorCreate: 'Failed to create tag.',
      successDelete: 'Tag removed successfully.',
      errorDelete: 'Failed to remove tag.',
      errorFetch: 'Failed to load tags.',
    },
    contacts: {
      title: 'Contacts',
      subtitle: 'Manage your contact base',
      addNew: 'Add new contact',
      name: 'Name',
      phone: 'Phone',
      tags: 'Tags',
      addBtn: 'Add contact',
      allContacts: 'All contacts',
      noContacts: 'No contacts found',
      successCreate: 'Contact created successfully.',
      errorCreate: 'Failed to create contact.',
      successDelete: 'Contact removed successfully.',
      errorDelete: 'Failed to remove contact.',
      errorFetch: 'Failed to load contacts.',
    },
    lists: {
      title: 'Contact Lists',
      subtitle: 'Create and manage contact lists',
      createTitle: 'Create a contact list',
      name: 'List name',
      namePlaceholder: 'Customer leads',
      createBtn: 'Create list',
      allLists: 'All lists',
      noLists: 'No lists found',
      viewContacts: 'View contacts',
      hideContacts: 'Hide contacts',
      noContacts: 'No contacts in this list.',
      totalContacts: 'Total contacts: {count}',
      successCreate: 'List created successfully.',
      errorCreate: 'Failed to create list.',
      errorFetch: 'Failed to load lists.',
      errorFetchContacts: 'Failed to load list contacts.',
    },
    import: {
      title: 'Import Contacts',
      subtitle: 'Bulk import contacts in one step',
      formTitle: 'Bulk import',
      helper: 'Paste a CSV or JSON payload. Example: name,number',
      payloadLabel: 'Contacts payload',
      payloadPlaceholder: 'name,number\nJane Doe,5511999999999',
      uploadLabel: 'Upload CSV/JSON file',
      preview: 'Preview',
      listLabel: 'Assign to list',
      listPlaceholder: 'Select a list',
      tagsLabel: 'Assign tags',
      noTags: 'No tags available',
      submit: 'Import contacts',
      success: 'Contacts imported successfully.',
      error: 'Failed to import contacts.',
      invalidPayload: 'Invalid payload. Use CSV or JSON.',
      emptyPayload: 'Please provide at least one contact.',
      resultTitle: 'Import summary',
      imported: 'Imported: {count}',
      skipped: 'Skipped duplicates: {count}',
      resultList: 'List: {list}',
      none: 'None',
    },
    campaigns: {
      title: 'Campaigns',
      subtitle: 'Create and manage campaigns',
      createNew: 'Create new campaign',
      name: 'Campaign name',
      connection: 'Connection',
      selectConnection: 'Select a connection',
      contactList: 'Contact list',
      selectContactList: 'Select a list',
      msgsPerMin: 'Messages per minute',
      mediaUrl: 'Media URL',
      messageBody: 'Message body',
      targetTags: 'Target tags',
      createBtn: 'Create campaign',
      allCampaigns: 'All campaigns',
      noCampaigns: 'No campaigns found',
      stats: 'Stats',
      logs: 'Logs',
      start: 'Start',
      pause: 'Pause',
      resume: 'Resume',
      successCreate: 'Campaign created successfully.',
      errorCreate: 'Failed to create campaign.',
      successStart: 'Campaign started successfully.',
      errorStart: 'Failed to start campaign.',
      successPause: 'Campaign paused successfully.',
      errorPause: 'Failed to pause campaign.',
      successResume: 'Campaign resumed successfully.',
      errorResume: 'Failed to resume campaign.',
      errorFetch: 'Failed to load campaigns.',
      status: {
        draft: 'Draft',
        running: 'Running',
        processing: 'Processing',
        completed: 'Completed',
        paused: 'Paused',
        failed: 'Failed',
      },
    },
    logs: {
      title: 'Campaign logs',
      subtitle: 'Delivery status per contact',
      noLogs: 'No logs found.',
      errorFetch: 'Failed to load logs.',
    },
    stats: {
      title: 'Campaign stats',
      subtitle: 'Performance overview',
      errorFetch: 'Failed to load stats.',
    },
  },
  pt: {
    nav: {
      appName: 'Gerenciador de Campanhas WhatsApp',
      dashboard: 'Dashboard',
      connections: 'Conexões',
      tags: 'Tags',
      contacts: 'Contatos',
      lists: 'Listas',
      contactsImport: 'Importar Contatos',
      campaigns: 'Campanhas',
    },
    common: {
      refresh: 'Atualizar',
      loading: 'Carregando...',
      success: 'Sucesso',
      error: 'Erro',
      required: '(obrigatório)',
      optional: '(opcional)',
      connected: 'Conectado',
      disconnected: 'Desconectado',
    },
    auth: {
      loginTitle: 'Entrar',
      loginSubtitle: 'Acesse o seu painel',
      registerTitle: 'Criar conta',
      registerSubtitle: 'Configure seu espaço de trabalho',
      firstName: 'Nome',
      lastName: 'Sobrenome',
      phone: 'Telefone',
      email: 'Email',
      password: 'Senha',
      loginButton: 'Entrar',
      registerButton: 'Criar conta',
      loginError: 'Não foi possível entrar. Verifique suas credenciais.',
      registerError: 'Não foi possível criar a conta. Tente novamente.',
      loading: 'Processando...',
      noAccount: 'Não tem conta?',
      createAccount: 'Criar agora',
      hasAccount: 'Já tem conta?',
      signIn: 'Entrar',
      logout: 'Sair',
    },
    dashboard: {
      title: 'Dashboard',
      subtitle: 'Visão geral das suas operações',
      quickActions: 'Ações rápidas',
      manageConnections: 'Gerenciar conexões',
      createTags: 'Criar tags',
      addContacts: 'Adicionar contatos',
      startCampaign: 'Iniciar campanha',
    },
    connections: {
      title: 'Conexões',
      subtitle: 'Gerencie suas conexões de envio',
      createNew: 'Criar nova conexão',
      name: 'Nome',
      instanceName: 'Nome da instância',
      apiUrl: 'URL da API',
      apiKey: 'Chave da API',
      createBtn: 'Criar conexão',
      activeTitle: 'Conexões ativas',
      noConnections: 'Nenhuma conexão encontrada',
      successCreate: 'Conexão criada com sucesso.',
      errorCreate: 'Falha ao criar conexão.',
      successDelete: 'Conexão removida com sucesso.',
      errorDelete: 'Falha ao remover conexão.',
      errorFetch: 'Falha ao carregar conexões.',
    },
    tags: {
      title: 'Tags',
      subtitle: 'Organize contatos com tags',
      createNew: 'Criar nova tag',
      name: 'Nome da tag',
      createBtn: 'Criar tag',
      allTags: 'Todas as tags',
      noTags: 'Nenhuma tag encontrada',
      successCreate: 'Tag criada com sucesso.',
      errorCreate: 'Falha ao criar tag.',
      successDelete: 'Tag removida com sucesso.',
      errorDelete: 'Falha ao remover tag.',
      errorFetch: 'Falha ao carregar tags.',
    },
    contacts: {
      title: 'Contatos',
      subtitle: 'Gerencie sua base de contatos',
      addNew: 'Adicionar novo contato',
      name: 'Nome',
      phone: 'Telefone',
      tags: 'Tags',
      addBtn: 'Adicionar contato',
      allContacts: 'Todos os contatos',
      noContacts: 'Nenhum contato encontrado',
      successCreate: 'Contato criado com sucesso.',
      errorCreate: 'Falha ao criar contato.',
      successDelete: 'Contato removido com sucesso.',
      errorDelete: 'Falha ao remover contato.',
      errorFetch: 'Falha ao carregar contatos.',
    },
    lists: {
      title: 'Listas de Contatos',
      subtitle: 'Crie e gerencie listas de contatos',
      createTitle: 'Criar lista de contatos',
      name: 'Nome da lista',
      namePlaceholder: 'Leads de clientes',
      createBtn: 'Criar lista',
      allLists: 'Todas as listas',
      noLists: 'Nenhuma lista encontrada',
      viewContacts: 'Ver contatos',
      hideContacts: 'Ocultar contatos',
      noContacts: 'Nenhum contato nesta lista.',
      totalContacts: 'Total de contatos: {count}',
      successCreate: 'Lista criada com sucesso.',
      errorCreate: 'Falha ao criar lista.',
      errorFetch: 'Falha ao carregar listas.',
      errorFetchContacts: 'Falha ao carregar contatos da lista.',
    },
    import: {
      title: 'Importar Contatos',
      subtitle: 'Importe contatos em massa',
      formTitle: 'Importação em massa',
      helper: 'Cole um CSV ou JSON. Exemplo: nome,numero',
      payloadLabel: 'Payload de contatos',
      payloadPlaceholder: 'nome,numero\nMaria,5511999999999',
      uploadLabel: 'Enviar arquivo CSV/JSON',
      preview: 'Pré-visualização',
      listLabel: 'Atribuir a lista',
      listPlaceholder: 'Selecione uma lista',
      tagsLabel: 'Atribuir tags',
      noTags: 'Nenhuma tag disponível',
      submit: 'Importar contatos',
      success: 'Contatos importados com sucesso.',
      error: 'Falha ao importar contatos.',
      invalidPayload: 'Payload inválido. Use CSV ou JSON.',
      emptyPayload: 'Informe pelo menos um contato.',
      resultTitle: 'Resumo da importação',
      imported: 'Importados: {count}',
      skipped: 'Ignorados: {count}',
      resultList: 'Lista: {list}',
      none: 'Nenhuma',
    },
    campaigns: {
      title: 'Campanhas',
      subtitle: 'Crie e gerencie campanhas',
      createNew: 'Criar nova campanha',
      name: 'Nome da campanha',
      connection: 'Conexão',
      selectConnection: 'Selecione uma conexão',
      contactList: 'Lista de contatos',
      selectContactList: 'Selecione uma lista',
      msgsPerMin: 'Mensagens por minuto',
      mediaUrl: 'URL da mídia',
      messageBody: 'Corpo da mensagem',
      targetTags: 'Tags alvo',
      createBtn: 'Criar campanha',
      allCampaigns: 'Todas as campanhas',
      noCampaigns: 'Nenhuma campanha encontrada',
      stats: 'Estatísticas',
      logs: 'Logs',
      start: 'Iniciar',
      pause: 'Pausar',
      resume: 'Retomar',
      successCreate: 'Campanha criada com sucesso.',
      errorCreate: 'Falha ao criar campanha.',
      successStart: 'Campanha iniciada com sucesso.',
      errorStart: 'Falha ao iniciar campanha.',
      successPause: 'Campanha pausada com sucesso.',
      errorPause: 'Falha ao pausar campanha.',
      successResume: 'Campanha retomada com sucesso.',
      errorResume: 'Falha ao retomar campanha.',
      errorFetch: 'Falha ao carregar campanhas.',
      status: {
        draft: 'Rascunho',
        running: 'Em execução',
        processing: 'Processando',
        completed: 'Concluída',
        paused: 'Pausada',
        failed: 'Falhou',
      },
    },
    logs: {
      title: 'Logs da campanha',
      subtitle: 'Status de envio por contato',
      noLogs: 'Nenhum log encontrado.',
      errorFetch: 'Falha ao carregar logs.',
    },
    stats: {
      title: 'Estatísticas da campanha',
      subtitle: 'Visão geral de performance',
      errorFetch: 'Falha ao carregar estatísticas.',
    },
  },
};

const LanguageContext = createContext({
  language: 'pt',
  setLanguage: () => {},
  t: (key, variables) => key,
});

const getValue = (obj, path) =>
  path.split('.').reduce((acc, part) => (acc ? acc[part] : undefined), obj);

const interpolate = (value, variables = {}) => {
  if (typeof value !== 'string') {
    return value;
  }
  return Object.entries(variables).reduce(
    (acc, [key, val]) => acc.replaceAll(`{${key}}`, String(val)),
    value,
  );
};

export const LanguageProvider = ({ children }) => {
  const [language, setLanguage] = useState('pt');

  const t = useMemo(() => {
    return (key, variables) => {
      const translation = getValue(translations[language], key);
      if (translation === undefined) {
        return key;
      }
      return interpolate(translation, variables);
    };
  }, [language]);

  const value = useMemo(() => ({ language, setLanguage, t }), [language, t]);

  return (
    <LanguageContext.Provider value={value}>
      {children}
    </LanguageContext.Provider>
  );
};

export const useTranslation = () => useContext(LanguageContext);
